!function(){"use strict";const t=(t,e)=>{if(t){var n=document.createElement(t);return"object"==typeof e&&Object.keys(e).forEach((function(t){if(t.indexOf("data-")>-1)n.setAttribute(t,e[t]);else if("children"===t&&e[t].length){if("object"!=typeof e[t])throw new Error("function el: children prop must be defined as array");e[t].forEach((function(t){n.appendChild("string"==typeof t?document.createTextNode(t):t)}))}else n[t]=e[t]})),n}throw new Error("Cant create element without type.")},e=(t,e,a,o,s=!1)=>{var i=n(t,e,a,o,s);return{amount:Math.max(0,t-i.shorten),expenses:i}},n=(t,e,n,a,o)=>{var s=o?0:((t,e)=>Math.floor(365/12/365*e*t)/100)(t,a),i=o?0:n;return{fee:i,interest:s,shorten:e-(s+i)}},a=(t,n,a,s)=>{let i=1,p=t;const r={interests:[0],fees:[0],shorts:[t]};let l=0;for(;p>0&&l<300;){let o;o=1===i?e(t,n,a,s,!0):e(p,n,a,s),p=o.amount,r.fees.push(o.expenses.fee),r.interests.push(o.expenses.interest),r.shorts.push(o.amount),i++,l++}return r.overall=r.fees.reduce(((t,e)=>t+e))+r.interests.reduce(((t,e)=>t+e)),{realInterest:o(r)+.0016,months:i,expenses:r}},o=t=>(t.fees.reduce(((t,e)=>t+e))+t.interests.reduce(((t,e)=>t+e)))/t.shorts.reduce(((t,e)=>t+e))*12,s={teaser:"Maksa 1 kk päästä toimituksesta ilman korkoja ja kuluja tai lyhennä sopivalla kuukausierällä!",ctaButton:"Tutustu ja hae",inputAmountLabel:"Rahoituksen määrä",product:{openButtonTextStart:"Tai",openButtonTextEnd:"rahoituksella."},floating:{openButton:"Maksa erissä"},linkMore:"Lue lisää maksutavasta"},i=t=>t.toFixed(2).replace(".",","),p=(t,e)=>"solo"===e?{content:"content"===t.type&&2===t.percentage.length,product:"product"===t.type&&2===t.percentage.length,floating:"floating"===t.type&&2===t.percentage.length}:{content:"content"===t.type&&t.percentage.length>2,product:"product"===t.type&&t.percentage.length>2,floating:"floating"===t.type&&t.percentage.length>2},r=t=>{const e=(t=>{const e=t&&t.details.interest_margin?t.details.interest_margin:7.45,n=a(1e4,170,7,e+t.details.prime);return{rate:e,calc:n,expenses:i(n.expenses.overall+1e4),moreLink:t&&t.linkMore&&t.linkMore.length?`<p class="op-keti__read-more"><a href="${t.linkMore}" target="_blank">${t.texts&&t.texts.linkMore?t.texts.linkMore:s.linkMore}</a></p>`:""}})(t),n=p(t,"solo"),o=p(t,"multi");return`\n  ${(t=>`\n  <style>\n  ${"product"!==t.type?`.op-keti__widget.op-keti__type--${t.type} .op-keti__btn-open,`:""}\n  .op-keti__type--${t.type} .op-keti__form-submit-btn,\n  .op-keti__type--${t.type} .op-keti__form-submit-btn:hover,\n  .op-keti__type--${t.type} .op-keti__form-submit-btn:focus {\n    background: ${t.colorPrimary};\n    color: ${t.colorSecondary};\n    border-color: ${t.colorPrimary};\n  }\n\n  .op-keti__type--${t.type} button.op-keti__btn:focus,\n  .op-keti__type--${t.type} button.op-keti__sum-button.selected,\n  .op-keti__type--${t.type} button.op-keti__sum-button.selected:focus,\n  .op-keti__type--${t.type} input[type=number]:focus,\n  .op-keti__container .op-keti__fieldset .op-keti__stepper:focus,\n  .op-keti__type--${t.type} input[type=text]:focus {\n    border-color: ${t.colorPrimary};\n  }\n\n  .op-keti__widget .op-keti__type--${t.type} button.op-keti__sum-button.selected {\n    border: 2px solid ${t.colorPrimary};\n  }\n\n  .op-keti__widget.op-keti__type--${t.type} fieldset .op-keti__stepper[data-action=down]:before,\n  .op-keti__widget.op-keti__type--${t.type} fieldset .op-keti__stepper[data-action=up]:before,\n  .op-keti__widget.op-keti__type--${t.type} fieldset .op-keti__stepper[data-action=up]:after {\n    background: ${t.colorPrimary};\n  }\n\n  .op-keti__widget.op-keti__type--${t.type} button.op-keti__btn.op-keti__sum-button:hover:not(:active):not(:focus) {\n    border: 1px solid ${t.colorPrimary};\n  }\n\n  .op-keti__widget.op-keti__type--${t.type} fieldset.op-keti__range-wrap input[type="range"]::-webkit-slider-runnable-track {\n    background: linear-gradient(${t.colorPrimary},${t.colorPrimary}) 0/var(--sx) 100% no-repeat, #fff !important;\n  }\n\n  .op-keti__widget.op-keti__type--${t.type} fieldset.op-keti__range-wrap input[type="range"]::-moz-range-progress {\n    background: linear-gradient(${t.colorPrimary},${t.colorPrimary}) 0/var(--sx) 100% no-repeat, #fff !important;\n  }\n\n  .op-keti__widget.op-keti__type--${t.type} fieldset.op-keti__range-wrap input[type="range"]::-ms-fill-lower {\n    background: ${t.colorPrimary} !important;\n  }\n\n  </style>\n`)(t)}\n\n  <form action="${t.linkCta}" method="GET" target="_blank">\n\n    ${"content"===t.type?"<h1 class=op-keti__heading>Maksa joustavasti erissä</h1>":""}\n\n    <fieldset class="op-keti__fieldset ${t.showInput?"":"op-keti__hidden"}">\n      <div class=op-keti__label-container>\n        <label for=op-keti__input-amount><span class=op-keti__label--text>${t.texts&&t.texts.inputAmountLabel?t.texts.inputAmountLabel:s.inputAmountLabel}&nbsp</span><span class=op-keti__label--helper>(<span class="op-keti__label--helper--min">${t.initAmountMin?parseFloat(t.initAmountMin).toLocaleString("fr"):parseFloat(t.details.min_amount).toLocaleString("fr")}</span> - ${parseFloat(t.details.max_amount).toLocaleString("fr")} €)<span></label>\n      </div>\n      <div class=op-keti__input-container>\n        <button class="op-keti__btn op-keti__stepper" data-action=down type=button ${t.enableInputChanges?"":"disabled=true"}>&nbsp;</button>\n        <div class=op-keti__input-wrapper>\n          <input class=op-keti__input-amount name=init_amount type=number pattern="d+" min=${t.initAmountMin?t.initAmountMin:t.details.min_amount} max=${t.details.max_amount} value=${t.initAmount} data-step=1000 ${t.enableInputChanges?"":"disabled=true"}>\n          <div class=op-keti__prefix class=op-prefix-euro ${t.enableInputChanges?"":"disabled=true"}><span class=op-keti__prefix--filler></span><span>&euro;</span></div>\n        </div>\n        <button class="op-keti__btn op-keti__stepper" data-action=up type=button ${t.enableInputChanges?"":"disabled=true"}>&nbsp;</button>\n      </div>\n    </fieldset>\n\n    ${"floating"===t.type?`<p class="op-keti__teaser-text">${t.texts&&t.texts.teaser?t.texts.teaser:s.teaser}</p>`:""}\n\n    ${o.product?`<p class="op-keti__teaser-text">${t.texts&&t.texts.teaser?t.texts.teaser:s.teaser}</p>`:""}\n\n    <fieldset class=op-keti__fieldset class=op-keti__sum-buttons-wrap>\n      ${o.content?"<div class=op-keti__label-container><label for=op-keti__sum-buttons>Kuukausierä</label></div>":""}\n      <div class="op-keti__input-container">\n        <div class=op-keti__sum-buttons></div>\n      </div>\n    </fieldset>\n\n    ${"floating"===t.type&&t.texts&&t.texts.altTeaser?`<p class="op-keti__teaser-text">${t.texts.altTeaser}</p>`:""}\n\n    ${o.product&&t.texts&&t.texts.altTeaser?`<p class="op-keti__teaser-text">${t.texts.altTeaser}</p>`:""}\n\n    ${n.content?`<fieldset class=op-keti__range-wrap><input type=range min="${t.initAmountMin?t.initAmountMin:t.details.min_amount} max=${t.details.max_amount}" max=50000 step=500></fieldset>`:""}\n\n    <div class="op-keti__result-rows">\n      ${"product"===t.type&&t.showInfo.costEstimate?"<div class=\"op-keti__result-row op-keti__result-row-heading\"><span><strong>Esimerkkilaskelma luoton kustannuksista</strong></span></div>":""}\n      ${n.product||n.floating?"<div class=\"op-keti__result-row\"><span>Kuukausierä</span><span class=op-keti__result-payback></span></div>":""}\n      ${(t=>({content:`\n<div class=op-keti__result-row>\n  <div class="op-keti__label-container"></div>\n  <div class="op-keti__result-container">\n  <span class="${t.showInfo.paybackTime?"":"op-keti__hidden"}"">Takaisinmaksuaika <strong class=op-keti__result></strong></span>\n  <span class="${t.showInfo.interestMargin?"":"op-keti__hidden"}">Korkomarginaali <strong class=op-keti__result-interest>${i(t.details.interest_margin)} %*</strong></span>\n  </div>\n</div>`,product:`\n<div class="op-keti__result-row ${t.showInfo.interestMargin?"":"op-keti__hidden"}">\n  <span>Korkomarginaali</span><span class=op-keti__result-interest>${i(t.details.interest_margin)} %*</span>\n</div>\n\n<div class="op-keti__result-row ${t.showInfo.realInterest?"":"op-keti__hidden"}">\n  <span>Todellinen vuosikorko</span><span class=op-keti__result-realinterest>&nbsp;</span>\n</div>\n\n<div class="op-keti__result-row ${t.showInfo.paybackTime?"":"op-keti__hidden"}">\n  <span>Takaisinmaksuaika</span><span class=op-keti__result></span>&nbsp;</span>\n</div>\n\n<div class="op-keti__result-row ${t.showInfo.costEstimate?"":"op-keti__hidden"}">\n  <span>Kustannusarvio</span><span class=op-keti__result-overall>&nbsp;</span>\n</div>`,floating:`\n<div class="op-keti__result-row ${t.showInfo.paybackTime?"":"op-keti__hidden"}"><span>Takaisinmaksuaika</span><span class=op-keti__result></span>&nbsp;</span></div>\n<div class="op-keti__result-row ${t.showInfo.interestMargin?"":"op-keti__hidden"}">\n  <span>Korkomarginaali</span><span class=op-keti__result-interest>${i(t.details.interest_margin)} %*</span>\n</div>`}[t.type]))(t)}\n    </div>\n\n    ${n.product?`<p class="op-keti__teaser-text">${s.teaser}</p>`:""}\n\n    <div class="op-keti__form-submit-wrap">\n      <input class=op-keti__input-payback type="hidden" name="init_payment" value="0">\n      ${(t=>`\n  <input class=op-keti__amount_payload type="hidden" name="cmpid" value=".haarta.4_${t.initAmount?t.initAmount:5e3}-17..site.partner.mn_sl_hark_widget.self">\n`)(t)}\n      <input class="op-keti__form-submit-btn ${t.showCta?"":"op-keti__hidden"}" type="submit" value="${t.texts&&t.texts.ctaButton?t.texts.ctaButton:s.ctaButton}">\n    </div>\n\n    ${n.product?`<p class="op-keti__teaser-text">${s.teaser}</p>`:""}\n\n    <div>\n      ${e.moreLink}\n    </div>\n  </form>\n\n  <footer>\n    ${n.content?"<div class=op-keti__content-result--solo class=\"op-keti__result-row\"><span>Kuukausierä alk.</span><span class=op-keti__result-payback></span></div>":""}\n\n    <p>\n      <small>\n      * Rahoitus on kertaluotto, jonka todellinen vuosikorko <span>7 500</span> euron luotolle on
  <span>${t.details.example_calculation_annual_interest.toFixed(2).replace(/\./g, ",")} %</span>, kun luoton korko on OP-prime +
  <span>${t.details.interest_margin.toFixed(2).replace(/\./g, ",")} %</span>
  (<span>${t.details.interest.toFixed(2).replace(/\./g, ",")} %</span>
  ${(() => {
    const d = new Date();
    return (d.getMonth() + 1) + "/" + d.getFullYear().toString().slice(-2); // esim. 2/26
  })()}),
  perustamismaksu <span>${t.details.opening_fee.toFixed(0).replace(/\./g, ",")} €</span> ja laskutuspalkkio
  <span>${t.details.handling_fee.toFixed(0).replace(/\./g, ",")} €/kk</span>. Arvioitu luoton kokonaiskustannus on
  <span>${t.details.example_calculation_total_payment.toFixed(2).replace(/\./g, ",")} €</span>. Laskelma on tehty olettaen, että luotto on nostettu kokonaan, luoton korko sekä maksut ja palkkiot pysyvät samana koko luottoajan ja luotto maksetaan takaisin
  <span>${t.details.example_calculation_monthly_payment.toFixed(2).replace(/\./g, ",")} €</span> minimilyhennyksin (1,70 % luoton määrästä) kuukauden välein, jolloin luottoaika on
  <span>${t.details.example_calculation_months.toFixed(0).replace(/\./g, ",")} kk</span>. Luoton myöntää OP Yrityspankki Oyj, Gebhardinaukio 1, 00510 Seinäjoki.\n        </small>\n     </p>\n     ${"content"===t.type?`<button class="op-keti__form-submit-btn op-keti__form-submit-btn-alt ${t.showCta?"":"op-keti__hidden"}">${t.texts&&t.texts.ctaButton?t.texts.ctaButton:s.ctaButton}</button>`:""}\n  </footer>\n  `};function l(t,e,n=!1){return n?t.querySelectorAll(e):t.querySelector(e)}const c=(t,e)=>{const n=document.createEvent("HTMLEvents");n.initEvent(e,!1,!0),t.dispatchEvent(n)},u=(e,n,a)=>{let o=!1;e.forEach(((s,i)=>{const p=parseInt(l(a,".op-keti__input-amount").value,10),r=(s*p).toFixed(0),u=Boolean(n[i]),_=u?n[i]:t("button",{className:"op-keti__btn op-keti__sum-button",type:"button"});_.textContent=`${r} € / kk`,_.dataset.payback=r,_.dataset.percentage=s,_.style.display=r>=50?"block":"none",1===i&&r<50&&(_.style.display="block",_.dataset.payback=50,_.textContent=`${_.dataset.payback} € / kk`),"0.012"===_.dataset.percentage&&(p<1e4?(_.style.display="none",n[0]&&n[1]&&n[0].classList.contains("selected")&&(_.classList.remove("selected"),n[1].classList.add("selected"),o=!0)):_.style.display="block"),2===e.length&&(p>=1e4?n[0]&&n[1]&&n[1].classList.contains("selected")&&(_.classList.remove("selected"),n[0].classList.add("selected"),o=!0):n[0]&&n[1]&&n[0].classList.contains("selected")&&(_.classList.remove("selected"),n[1].classList.add("selected"),o=!0)),u||(_.addEventListener("click",(()=>{l(a,"button.op-keti__sum-button",!0).forEach((t=>{t.classList.remove("selected")})),_.classList.add("selected"),c(l(a,".op-keti__input-amount"),"change")})),1===i&&(_.classList.add("selected"),o=!0),l(a,".op-keti__sum-buttons").appendChild(_),n.push(_))})),o&&c(l(a,".op-keti__input-amount"),"change")};function _(t,e){const n=p(e,"solo");p(e,"multi");const o=e&&e.percentage&&e.percentage.length?e.percentage:[.012,.017,.021,.028,.033,.05,.09],i=[];this.setAmount=e=>{const n=l(t,".op-keti__input-amount"),a=parseInt(e,10);return parseInt(l(t,".op-keti__input-amount").value,10)!==a&&(n.value=a,c(n,"change"),!0)},this.setAmountMin=e=>{const n=l(t,".op-keti__input-amount"),a=parseInt(e,10);return l(t,".op-keti__label--helper--min").textContent=String(a).toLocaleString("fr"),n.min=a,c(n,"change"),!0},l(t,".op-keti__stepper",!0).forEach((t=>{t.addEventListener("click",(()=>{const e=t.parentElement.querySelector("input");switch(t.dataset.action){case"up":e.value=parseInt(e.value)+parseInt(e.dataset.step);break;case"down":e.value=parseInt(e.value)-parseInt(e.dataset.step)}c(e,"change")}))})),"content"===e.type&&l(t,".op-keti__form-submit-btn-alt").addEventListener("click",(()=>{l(t,".op-keti__container form").submit()})),u(o,i,t),l(t,".op-keti__input-amount").addEventListener("change",(p=>{const r=p.currentTarget;(t=>{const e=parseInt(t.value),n=()=>t.value=parseInt(t.min);isNaN(e)&&n();try{e>parseInt(t.max)&&(t.value=t.max),e<parseInt(t.min)&&(t.value=t.min)}catch(p){n()}})(r),u(o,i,t);const c=parseInt(r.value,10);if("product"===e.type){const n=e.texts&&e.texts.product&&e.texts.product.openButtonTextStart?e.texts.product.openButtonTextStart:s.product.openButtonTextStart,a=e.texts&&e.texts.product&&e.texts.product.openButtonTextEnd?e.texts.product.openButtonTextEnd:s.product.openButtonTextEnd,{percentage:o}=l(t,".op-keti__sum-button.selected").dataset,i="0.017"===o&&c<1e4||"0.012"===o&&c>=1e4;l(t,".op-keti__btn-open").innerHTML=`${n} ${i?"alk.":"esim."} <span class=op-keti__btn-open__sum>0,00</span> €/kk ${a}`}const _=l(t,".op-keti__sum-button.selected"),d=parseInt(_.dataset.payback,10),k=[..._.parentElement.children].indexOf(_);l(t,".op-keti__input-payback").value=k,l(t,".op-keti__amount_payload").value=`.haarta.4_${c}-${(1e3*o[k]).toFixed(0)}..site.partner.mn_sl_hark_widget.self`,!e||!e.details.interest_margin||e.details.interest_margin;const m=a(c,d,7,e.details.interest_margin+.75),y=Math.floor((m.months-1)/12),g=(m.months-1)%12;if(l(t,".op-keti__result").textContent=0===g?y+"v":y+"v "+g+"kk","product"===e.type&&(l(t,".op-keti__result-overall").textContent=`${(m.expenses.overall+c).toFixed(2).replace(".",",")} €`,l(t,".op-keti__result-realinterest").textContent=`${(100*m.realInterest).toFixed(2).replace(".",",")} %`,l(t,".op-keti__btn-open__sum").textContent=d.toFixed(2).replace(/\./,",")),l(t,".op-keti__result-payback")&&(l(t,".op-keti__result-payback").textContent=`${d} € / kk`),n.content){l(t,"input[type=\"range\"]").value=c;for(let t of document.querySelectorAll("input[type=range]"))t.style.setProperty("--value",t.value),t.style.setProperty("--min",""==t.min?"0":t.min),t.style.setProperty("--max",""==t.max?"100":t.max),t.addEventListener("input",(()=>t.style.setProperty("--value",t.value)))}})),n.content&&l(t,"input[type=\"range\"]").addEventListener("change",(function(e){l(t,".op-keti__input-amount").value=e.currentTarget.value,c(l(t,".op-keti__input-amount"),"change")})),c(l(t,".op-keti__input-amount"),"change")}let d,k=0;function m(){if(!window.fetch)return!1;const e=Object.assign(window.__opCalcAccount||{},{}),n=Object.assign(window.__opCalcOpts||{},{});return k>=5?(clearInterval(d),!1):Object.keys(n).length&&Object.keys(e).length?(window.clearInterval(d),fetch(`https://eficode.pohjola-finance.fi/${e.mode}/api/dealers/${e.key}`).then((t=>t.json())).then((e=>{Object.keys(n).forEach((a=>{let o=n[a];if(o=Object.assign({details:e},o),document.querySelector(`.op-keti__${o.type}`))return!1;try{const e=document,n="op-keti--opened",a={floating:"op-keti__fixed",product:"op-keti__fixed",content:"op-keti--opened"},i=t("div",{className:`op-keti__widget op-keti__type--${o.type} op-keti__type--${2===o.percentage.length?"solo":"multi"} ${a[o.type]}`}),p=t("div",{className:"op-keti__container"}),l=t("button",{textContent:o.texts&&o.texts.floating&&o.texts.floating.openButton?o.texts.floating.openButton:s.floating.openButton,classList:"op-keti__btn-open"}),c=t("button",{className:"op-keti__btn-close",textContent:"×"});if(p.appendChild(c),p.insertAdjacentHTML("beforeend",r(o)),i.appendChild(l),i.appendChild(p),"floating"===o.type)e.body.appendChild(i);else{const t=e.querySelector(o.selector?o.selector:`#op-keti-init-${o.type}`);if(!t)return console.warn(`Financing calculator: Selector ${o.selector?o.selector:`#op-keti-init-${o.type}`} does not exist!`),!1;t.insertAdjacentElement("afterend",i)}const u=(t,e)=>{t.classList.contains(e)?t.classList.remove(e):t.classList.add(e)};l.addEventListener("click",(()=>{u(i,n)})),c.addEventListener("click",(()=>{u(i,n)})),window.__opCalcWidget=window.__opCalcWidget?window.__opCalcWidget:{},window.__opCalcWidget[o.type]=new _(i,o)}catch(i){const t=document.querySelector(`#op-keti-init-${o.type}`);t&&t.remove(),console.error(i)}}))})),!0):(console.log("Financing calculator: Cannot find options!"),console.log(`Financing calculator: Retrying ${k+1} / 5 ...`),k+=1,d||(d=setInterval(m,5e3)),!1)}var y;y=t=>{setTimeout((()=>{m()}),10)},"interactive"===document.readyState||"complete"===document.readyState?y("params"):document.addEventListener("DOMContentLoaded",y.bind(null,"params"))}();
